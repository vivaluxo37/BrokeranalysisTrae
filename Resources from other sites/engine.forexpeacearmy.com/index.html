
        window.AdGlare = window.AdGlare || {q:[],run:function(){}};
        window.AdGlare.q.push(function(){
            AdGlare.setZone(298172139).load();
        });
        window.AdGlare.run();
    
        (function() {
            window.AdGlare = window.AdGlare || {q:[],run:function(){}};
            if(!window.AdGlare.expanded) {
                Object.assign(window.AdGlare,{
                    expanded: true,
                    campaign_ids: {},
                    creative_ids: {},
                    win_id: Math.random().toString(36).slice(-5),
                    //referer: encodeURIComponent((function(){try{return window.top.location.href;} catch(e) {return document.location.href || '';}})()),
                    referer: encodeURIComponent(((function(){ if(window.self !== window.top) return document.referrer; try { return top.location.href; } catch { try { return window.location.href; } catch { try { return document.location.href; } catch { return ''; } } } })()) || 'https://www.forexpeacearmy.com/'),
                    setZone: function(zoneId) {
                        var obj = {
                            data: {win_id:this.win_id, referer:this.referer, capped:this.caps.get()},
                            zoneId: zoneId,
                            adSizes: function(a){
                                if(!Array.isArray(a)) {
                                    AdGlare.warn("adSizes() for zone_id "+this.zoneId+": expecting an array. Example: ['300x250','468x60']. You added: '"+a+"'");
                                    return this;
                                }
                                for(var i=0; i<a.length; i++) {
                                    if(!/^\d{1,4}x\d{1,4}$/.test(a[i])) {
                                        AdGlare.warn("adSizes() for zone_id "+this.zoneId+": invalid item: '"+a[i]+"'. Example: 300x250");
                                        a.splice(i,1);
                                    }
                                }
                                this.data.ad_sizes = a.join(',');
                                return this;
                            },
                            keyWords: function(a){
                                if(!Array.isArray(a)) {
                                    AdGlare.warn("keyWords() for zone_id "+this.zoneId+": expecting an array. Example: ['cars','audi']. You added: '"+a+"'");
                                    return this;
                                }
                                for(var i=0; i<a.length; i++) {
                                    a[i] = a[i].toString().replace(/[^a-zA-Z0-9_\-]/g,'');
                                }
                                this.data.keywords = a.join(',');
                                return this;
                            },
                            keyValues: function(a){
                                if(typeof a !== 'object') {
                                    AdGlare.warn("keyValues() for zone_id "+this.zoneId+": expecting an object. Example: {'color':'red'}. You added: '"+a+"'");
                                    return this;
                                }
                                for(var key in a) {
                                    var val = encodeURIComponent(a[key].toString());
                                    key = key.toString().replace(/[^a-zA-Z0-9_\-]/g,'');
                                    this.data['kv_'+key] = val;
                                }
                                return this;
                            },
                            customMacros: function(a){
                                if(typeof a !== 'object') {
                                    AdGlare.warn("customMacros() for zone_id "+this.zoneId+": expecting an object. Example: {'{color}':'red','{make}':'volkswagen'}. You added: '"+a+"'");
                                    return this;
                                }
                                for(var key in a) {
                                    var val = encodeURIComponent(a[key].toString());
                                    key = key.toString().replace(/[^a-zA-Z0-9{}]/g,'');
                                    if(key.substr(0,1)!='{' || key.substr(-1,1)!='}') {
                                        AdGlare.warn("customMacros() for zone_id "+this.zoneId+": macro keys should be in curly brackets. Example: {'{color}':'red'}. You added: {'"+key+"':'"+a[key].toString()+"'}");
                                        return this;
                                    }
                                    this.data['ag_custom_'+key.substr(1,key.length-2)] = val;
                                }
                                return this;
                            },
                            clickTrackingURL: function(a){
                                if(typeof a !== 'string') {
                                    AdGlare.warn("clickTrackingURL() for zone_id "+this.zoneId+": expecting a string containing a URL. Example: 'https://track.com/?19dj2n4'. You added: '"+a+"'");
                                    return this;
                                }
                                if(!/^(https?:\/\/)/i.test(a)) {
                                    if(a!='CLICK_URL_MACRO_HERE') AdGlare.warn("clickTrackingURL() for zone_id "+this.zoneId+": invalid URL: "+a+"");
                                    return this;
                                }
                                this.data.clcturl = encodeURIComponent(a.toString());
                                return this;
                            },
                            pageURL: function(a){
                                a = a.toString();
                                if(!/^(https?:\/\/)/i.test(a)) {
                                    AdGlare.warn("pageURL() for zone_id "+this.zoneId+": invalid URL: "+a+"");
                                    return this;
                                }
                                this.data.referer = encodeURIComponent(a);
                                return this;
                            },
                            preferredCampaignIds: function(a){
                                if(!Array.isArray(a)) {
                                    AdGlare.warn("preferredCampaignIds() for zone_id "+this.zoneId+": expecting an array. Example: [123456789,987654321]. You added: '"+a+"'");
                                    return this;
                                }
                                for(var i=0; i<a.length; i++) a[i] = a[i].toString().replace(/[^0-9]/g,'');
                                this.data.preferred_campaign_ids = a.join(',');
                                return this;
                            },
                            setRefresh: function(){
                                this.data.is_refresh = 1;
                                return this;
                            },
                            load: function() {
                                var q = '';
                                for(var prop in this.data) {
                                    var v = this.data[prop];
                                    if(!v) continue;
                                    q += '&' + prop + '=' + (typeof v === 'object' ? v.join('-') : v);
                                }
                                q += (AdGlare.campaign_ids.length>0) ? '&campaign_ids='+Object.values(AdGlare.campaign_ids).join('-') : '';
                                q += (AdGlare.creative_ids.length>0) ? '&creative_ids='+Object.values(AdGlare.creative_ids).join('-') : '';
                                (function(t,r,w,d,u) {
                                    var s = d.createElement(r); s.async = true;
                                    s.src = u; var n = d.getElementsByTagName(r)[0];
                                    n.parentNode.insertBefore(s,n);
                                })(this,'script',window,document,'https://engine.forexpeacearmy.com/?'+this.zoneId+q+'&cb=' + Date.now() + Math.random());
                            },
                        };
                        return obj;
                    },
                    warn: function(m) {
                        console.warn('[AdGlare WARNING]: '+m);
                    },
                    run: function(){
                        while(window.AdGlare.q.length>0) {
                            var o = window.AdGlare.q.shift();
                            if(typeof o == 'function') o();
                        }
                    },
                    events: {
                        timer: null,
                        q: [],
                        queue: function(url,token) {
                            this.q[url] = this.q[url] || [];
                            this.q[url].push(token);
                            if(!this.timer) this.timer = setTimeout(this.send, 5);
                        },
                        send: function() {
                            AdGlare.events.timer = null;
                            var d = AdGlare.events.q;
                            AdGlare.events.q = [];
                            for(var url in d) {
                                if(d.hasOwnProperty(url)) {
                                    var p = d[url].join('|');
                                    if(navigator.sendBeacon) {
                                        if(navigator.sendBeacon(url,p) === true) continue;
                                    }
                                    if(window.XMLHttpRequest) {
                                        var xhr = new XMLHttpRequest();
                                        xhr.open('POST',url,true);
                                        xhr.send(p);
                                        continue;
                                    }
                                    for(var data in d[url]) {
                                        if(d[url].hasOwnProperty(data)) {
                                            var i = document.createElement('IMG');
                                            i.style.cssText = 'width:1px;height:1px;position:fixed;opacity:0.01;left:0;bottom:0;';
                                            i.src = url + '?data=' + d[url][data];
                                            var el = document.getElementsByTagName('script')[0];
                                            el.parentNode.insertBefore(i, el);
                                        }
                                    }
                                }
                            }
                        }
                    },
                    caps: {
                        now: Math.round(new Date().getTime()/1000),
                        capdata: JSON.parse(localStorage.getItem('capdata')) || {},
                        get: function() {
                            var capped = [];
                            for(var i in this.capdata) {
                                let a = this.capdata[i];
                                if(!a['exp'] || this.now > parseInt(a['exp'])) delete this.capdata[i];
                                else if(a['count'] >= a['max']) capped.push(parseInt(i.substr(1)));
                            }
                            this.capdata = Object.fromEntries(Object.entries(this.capdata).slice(-50));
                            if(JSON.stringify(this.capdata) != JSON.stringify(JSON.parse(localStorage.getItem('capdata'))||{})) localStorage.setItem('capdata',JSON.stringify(this.capdata));
                            return (capped.length>0) ? capped : '';
                        },
                        set: function(campaign_id,max,exp) {
                            if(!exp) return;
                            let a = this.capdata['c'+campaign_id];
                            if(a) {
                                a['max'] = max;
                                if(a['exp_original'] != exp) {
                                    a['exp'] = this.now+exp;
                                    a['exp_original'] = exp;
                                }
                                a['count'] += 1; 
                            } else {
                                a = {'max':max,'exp':this.now+exp,'exp_original':exp,'count':1};
                            }
                            this.capdata['c'+campaign_id] = a;
                            localStorage.setItem('capdata',JSON.stringify(this.capdata));
                            console.log(localStorage.getItem('capdata'));
                        }
                    },
                    hasAbsoluteParent: function(e,max) {
                        if(!e || e === document.body || max>5) return false;
                        var p = window.getComputedStyle(e).position;
                        if(p === 'absolute' || p === 'fixed') return true;
                        return AdGlare.hasAbsoluteParent(e.parentNode,(max||0)+1);
                    },
                });
            }
            window.AdGlare.run();
        })();
    